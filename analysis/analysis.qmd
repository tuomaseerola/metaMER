# Analysis

This assumes that the data has been parsed from the BibTeX files into table and exported as CSV file.

# Analysis

Initial work to build the data parser from the bibTeX files.

## Read annotated data

- Update 2024-06-19
- TODO: find better way to read in functions

```{r}
require(here)
source(here::here('R/build-df.R'))
source(here::here('R/format-study-results.R'))
source(here::here('R/parse-model-output.R'))
```

```{r}
# get metaMER df:

meta_df <- get_metaMER_df(path_2_studies = here::here('studies'))

# get included studies

included_studies <- meta_df[which(
  !stringr::str_detect(meta_df$final_notes, '!EXCL!')),] |> 
  dplyr::tibble()

```

```{r}
# get studies re-coded (currently identifiable by presence of bind_field.)
recoded_studies <- included_studies[which(stringr::str_detect(
  included_studies$model_rate_emotion_values,
                                     'bind_field')),] 

```

```{r}
metaMER_results <-
do.call(
  rbind,
    lapply(1:nrow(recoded_studies),
       function(x) get_study_results(recoded_studies[x,])
       )
) 


metaMER_results |> dplyr::tibble()

```


## Read annotated data

```{r}
#| eval: false
d <- read.csv('data/meta-analysis_data.csv')
```

We need to identify the core metrics:

- _correlation coefficient_ (obtained from $R^2$) for regression studies.

- _Matthew's correlation coefficient_ for classification studies.

- n (we use STIMULUS_N rather than participant n)

- Subsetting base on model and music qualities

## Analyse

### Regression studies

#### Valence

```{r}
#| warning: false
#| eval: false
library(dmetar)
library(tidyverse)
library(meta)

# select regression studies

m.cor <- metacor(cor = valence, 
                 n = stimulus_N,
                 studlab = study_id,
                 data = df,
                 fixed = FALSE,
                 random = TRUE,
                 method.tau = "REML",
                 method.random.ci = "HK",
                 title = "MER: Regression: Valence: All")

```

